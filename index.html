<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Telegram File Sync</title>
  <style>
    :root {
      --bg-color: #121212;
      --text-color: white;
      --drop-zone-border: #4caf50;
      --progress-bg: #333;
      --progress-bar: #4caf50;
      --file-item-bg: #1e1e1e;
      --btn-bg: #4caf50;
      --btn-text: white;
    }
    body {
      font-family: sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: start;
      height: 100vh;
      margin: 0;
      padding-top: 40px;
    }
    body.light {
      --bg-color: #ffffff;
      --text-color: #000000;
      --file-item-bg: #f0f0f0;
      --progress-bg: #ddd;
    }
    .drop-zone {
      border: 2px dashed var(--drop-zone-border);
      padding: 30px;
      text-align: center;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
      background: var(--file-item-bg);
      cursor: pointer;
    }
    .custom-upload-btn {
      background: var(--btn-bg);
      color: var(--btn-text);
      border: none;
      padding: 10px 20px;
      margin-top: 10px;
      border-radius: 8px;
      cursor: pointer;
    }
    .progress-container {
      width: 100%;
      max-width: 500px;
      margin-top: 20px;
    }
    .progress {
      width: 100%;
      height: 8px;
      background: var(--progress-bg);
      border-radius: 4px;
      overflow: hidden;
    }
    .bar {
      width: 0%;
      height: 100%;
      background: var(--progress-bar);
    }
    .file-list {
      margin-top: 20px;
      width: 90%;
      max-width: 500px;
    }
    .file-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: var(--file-item-bg);
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .file-name {
      flex: 1;
      margin-right: 10px;
    }
    .download-btn {
      background: var(--btn-bg);
      color: var(--btn-text);
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    .search-bar {
      margin-top: 20px;
      width: 90%;
      max-width: 500px;
    }
    .search-input {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--drop-zone-border);
      background: var(--file-item-bg);
      color: var(--text-color);
    }
    .theme-toggle {
      position: absolute;
      top: 10px;
      right: 10px;
    }
    .theme-toggle button {
      background: var(--btn-bg);
      color: var(--btn-text);
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    .category-select {
      margin-top: 10px;
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--drop-zone-border);
      background: var(--file-item-bg);
      color: var(--text-color);
    }
    .file-preview {
      margin-top: 10px;
      max-width: 100%;
      max-height: 200px;
    }
  </style>
</head>
<body>
  <div class="theme-toggle">
    <button onclick="toggleTheme()">Toggle Theme</button>
  </div>
  <h2>üìÅ Telegram File Sharing System</h2>
  <div class="drop-zone" id="dropZone">
    <p>Drop files here or click to upload</p>
    <button class="custom-upload-btn" onclick="document.getElementById('fileInput').click()">Upload Files</button>
    <input type="file" id="fileInput" multiple hidden>
    <select class="category-select" id="categorySelect">
      <option value="general">General</option>
      <option value="images">Images</option>
      <option value="documents">Documents</option>
      <option value="videos">Videos</option>
    </select>
  </div>

  <div class="progress-container" id="progressContainer"></div>

  <div class="search-bar">
    <input type="text" class="search-input" id="searchInput" placeholder="Search files...">
  </div>

  <div class="file-list" id="fileList">
    <h3>Available Files</h3>
  </div>

  <script>
    const botToken = '7743009303:AAEfCdb2kU3xjZHbU-mo_qUbP3wA4aejDRo'; // ‡§Ö‡§™‡§®‡•á ‡§¨‡•â‡§ü ‡§ü‡•ã‡§ï‡§® ‡§∏‡•á ‡§¨‡§¶‡§≤‡•á‡§Ç
    const chatId = '878604830'; // ‡§Ö‡§™‡§®‡•á ‡§ö‡•à‡§ü ID ‡§∏‡•á ‡§¨‡§¶‡§≤‡•á‡§Ç
    const fileInput = document.getElementById('fileInput');
    const categorySelect = document.getElementById('categorySelect');
    const progressContainer = document.getElementById('progressContainer');
    const fileList = document.getElementById('fileList');
    const searchInput = document.getElementById('searchInput');
    let lastUpdateId = 0;
    let filesData = [];

    // Drag and Drop
    const dropZone = document.getElementById('dropZone');
    dropZone.addEventListener('dragover', e => {
      e.preventDefault();
      dropZone.style.borderColor = '#ff9800';
    });
    dropZone.addEventListener('dragleave', () => {
      dropZone.style.borderColor = '#4caf50';
    });
    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      dropZone.style.borderColor = '#4caf50';
      const files = e.dataTransfer.files;
      if (files.length > 0) uploadFiles(files);
    });

    fileInput.addEventListener('change', () => {
      const files = fileInput.files;
      if (files.length > 0) uploadFiles(files);
    });

    // ‡§Ö‡§™‡§≤‡•ã‡§° ‡§´‡§æ‡§á‡§≤‡•ç‡§∏ ‡§ï‡•ã ‡§Æ‡•à‡§®‡•á‡§ú ‡§ï‡§∞‡§®‡§æ
    function uploadFiles(files) {
      Array.from(files).forEach(file => {
        const category = categorySelect.value;
        const progressId = `progress-${Math.random().toString(36).substr(2, 9)}`;
        const progressHTML = `
          <div id="${progressId}" class="progress">
            <div class="bar" style="width: 0%"></div>
          </div>
        `;
        progressContainer.innerHTML += progressHTML;
        uploadFile(file, category, progressId);
      });
    }

    // ‡§´‡§æ‡§á‡§≤ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡§æ
    function uploadFile(file, category, progressId) {
      const formData = new FormData();
      formData.append('chat_id', chatId);
      formData.append('document', file);
      const xhr = new XMLHttpRequest();
      xhr.open('POST', `https://api.telegram.org/bot${botToken}/sendDocument`);
      xhr.upload.onprogress = (e) => {
        const percent = (e.loaded / e.total) * 100;
        document.querySelector(`#${progressId} .bar`).style.width = percent + '%';
      };
      xhr.onload = () => {
        document.querySelector(`#${progressId}`).remove();
        showNotification(`‚úÖ File Uploaded: ${file.name}`);
      };
      xhr.send(formData);
    }

    // ‡§ü‡•á‡§≤‡•Ä‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡•á ‡§®‡§à ‡§´‡§æ‡§á‡§≤‡•ç‡§∏ ‡§ï‡•ã ‡§™‡•ã‡§≤ ‡§ï‡§∞‡§®‡§æ
    async function pollTelegram() {
      try {
        const res = await fetch(`https://api.telegram.org/bot${botToken}/getUpdates?offset=${lastUpdateId + 1}`);
        const data = await res.json();
        data.result.forEach(msg => {
          lastUpdateId = msg.update_id;
          if (msg.message?.document) {
            const fileId = msg.message.document.file_id;
            const fileName = msg.message.document.file_name || 'Unnamed File';
            const category = categorySelect.value || 'general';
            filesData.push({ fileId, fileName, category });
            addFileToList(fileId, fileName, category);
            showNotification(`New file available: ${fileName}`);
          }
        });
      } catch (err) {
        console.log('Error polling Telegram:', err);
      }
    }

    // ‡§´‡§æ‡§á‡§≤ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡§®‡§æ ‡§î‡§∞ ‡§™‡•ç‡§∞‡•Ä‡§µ‡•ç‡§Ø‡•Ç ‡§¶‡§ø‡§ñ‡§æ‡§®‡§æ
    function addFileToList(fileId, fileName, category) {
      const fileItem = document.createElement('div');
      fileItem.classList.add('file-item');
      fileItem.setAttribute('data-category', category);
      fileItem.setAttribute('data-name', fileName.toLowerCase());
      fileItem.innerHTML = `
        <span class="file-name">${fileName} (${category})</span>
        <button class="download-btn" onclick="downloadFile('${fileId}', '${fileName}')">Download</button>
      `;
      // ‡§´‡§æ‡§á‡§≤ ‡§™‡•ç‡§∞‡•Ä‡§µ‡•ç‡§Ø‡•Ç
      if (fileName.match(/\.(jpeg|jpg|png|gif)$/i)) {
        const preview = document.createElement('img');
        preview.src = `https://api.telegram.org/file/bot${botToken}/${fileId}`;
        preview.classList.add('file-preview');
        fileItem.appendChild(preview);
      } else if (fileName.match(/\.pdf$/i)) {
        const preview = document.createElement('iframe');
        preview.src = `https://api.telegram.org/file/bot${botToken}/${fileId}`;
        preview.classList.add('file-preview');
        fileItem.appendChild(preview);
      }
      fileList.appendChild(fileItem);
    }

    // ‡§´‡§æ‡§á‡§≤ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡§æ
    async function downloadFile(fileId, fileName) {
      try {
        const res = await fetch(`https://api.telegram.org/bot${botToken}/getFile?file_id=${fileId}`);
        const data = await res.json();
        const filePath = data.result.file_path;
        const fileUrl = `https://api.telegram.org/file/bot${botToken}/${filePath}`;
        const link = document.createElement('a');
        link.href = fileUrl;
        link.download = fileName;
        document.body.appendChild(link);
        link.click();
        link.remove();
        showNotification(`Downloading: ${fileName}`);
      } catch (err) {
        console.log('Download error:', err);
      }
    }

    // ‡§∏‡§∞‡•ç‡§ö ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®‡•à‡§≤‡§ø‡§ü‡•Ä
    searchInput.addEventListener('input', () => {
      const query = searchInput.value.toLowerCase();
      document.querySelectorAll('.file-item').forEach(item => {
        const name = item.getAttribute('data-name');
        if (name.includes(query)) {
          item.style.display = 'flex';
        } else {
          item.style.display = 'none';
        }
      });
    });

    // ‡§•‡•Ä‡§Æ ‡§ü‡•â‡§ó‡§≤
    function toggleTheme() {
      if (document.body.classList.contains('light')) {
        document.body.classList.remove('light');
        localStorage.setItem('theme', 'dark');
      } else {
        document.body.classList.add('light');
        localStorage.setItem('theme', 'light');
      }
    }

    // ‡§∏‡•á‡§µ ‡§ï‡•Ä ‡§ó‡§à ‡§•‡•Ä‡§Æ ‡§ï‡•ã ‡§ö‡•á‡§ï ‡§ï‡§∞‡§®‡§æ
    if (localStorage.getItem('theme') === 'light') {
      document.body.classList.add('light');
    }

    // ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§™‡§∞‡§Æ‡§ø‡§∂‡§®
    if (Notification.permission !== 'granted') {
      Notification.requestPermission();
    }

    // ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§¶‡§ø‡§ñ‡§æ‡§®‡§æ
    function showNotification(message) {
      if (Notification.permission === 'granted') {
        new Notification(message);
      }
    }

    // ‡§π‡§∞ 3 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§Æ‡•á‡§Ç ‡§ü‡•á‡§≤‡•Ä‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§ï‡•ã ‡§™‡•ã‡§≤ ‡§ï‡§∞‡§®‡§æ
    setInterval(pollTelegram, 3000);
  </script>
</body>
</html>
